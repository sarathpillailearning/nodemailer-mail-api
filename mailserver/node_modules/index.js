
//Import Express
const express = require("express");
//Import MailHelper
const mailhelper = require("./components/mailhelper");
//Include Cross Origin Browser Support
const cors=require("cors");
router = express.Router();
app = express();
//Include URL Parameters and JSON Body request support
app.use(express.urlencoded());
app.use(express.json());
app.use(cors());

//Send Email API
app.post("/sendMail", (req, res) => {
  console.log(JSON.stringify(req.body));

    mailDetails = {
    to: req.body.to,
    subject: req.body.subject,
    text: req.body.text
  };
  //Calling Send Mail of MailHelper
 mailhelper.sendMail(mailDetails).then(
   function(result){
     //Success
    console.log(result);
    res.status(200).send("Sent Mail!");
   }
 ).then(
   //Error Handling
   undefined,function(err){
    console.log('In error');
    res.status(500).send(err.stack);
   }
 )
 


});

// Listen to the App Engine-specified port, or 8080 otherwise
const PORT = process.env.PORT || 8080;
app.listen(PORT, () => {
  console.log(`Server listening on port ${PORT}...`);
});
